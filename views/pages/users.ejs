<%- include('../partials/dashboardheader.ejs') %> <%if(users.length > 0){%>
<div class="content">
	<div class="container-xl">
		<!-- Page title -->
		<div class="page-header d-print-none">
			<div class="row align-items-center">
				<div class="col">
					<h2 class="page-title">Users</h2>
					<div class="text-muted mt-1">
						1-18 of <%=users.length%> people
					</div>
				</div>
				<!-- Page title actions -->
				<div class="col-auto ms-auto d-print-none">
					<div class="d-flex">
						<input
							type="search"
							class="form-control d-inline-block w-9 me-3"
							placeholder="Search userâ€¦"
						/>
						<a
							href="#"
							class="btn btn-primary"
							data-bs-toggle="modal"
							data-bs-target="#new-user"
						>
							<svg
								xmlns="http://www.w3.org/2000/svg"
								class="icon"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								stroke-width="2"
								stroke="currentColor"
								fill="none"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<line x1="12" y1="5" x2="12" y2="19" />
								<line x1="5" y1="12" x2="19" y2="12" />
							</svg>
							New user
						</a>
					</div>
				</div>
			</div>
		</div>
		<div class="row row-cards">
			<%for(var user of users){%>

			<div class="col-md-6 col-lg-3">
				<div class="card">
					<div class="card-body p-4 text-center">
						<span
							class="avatar avatar-xl mb-3 avatar-rounded"
							style="background-image: url(/<%=user.image%>)"
							></span
						>
						<h3 class="m-0 mb-1"><a href="#"><%=user.surname%> <%=user.othernames%></a></h3>
						<div class="text-muted"><%=user.role%></div>

						<div class="mt-3"></div>
					</div>
					<div class="d-flex">
						<a
							href="#"
							class="card-btn"
							data-bs-toggle="modal"
							data-bs-target="#modal-simple<%=user._id%>"
							><svg
								xmlns="http://www.w3.org/2000/svg"
								class="icon me-2 text-muted"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								stroke-width="2"
								stroke="currentColor"
								fill="none"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<rect x="3" y="5" width="18" height="14" rx="2" />
								<polyline points="3 7 12 13 21 7" />
							</svg>
							Email</a
						>

						<div
							class="modal modal-blur fade"
							id="modal-simple<%=user._id%>"
							tabindex="-1"
							role="dialog"
							aria-hidden="true"
						>
							<div
								class="modal-dialog modal-dialog-centered"
								role="document"
							>
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title">Email</h4>
										<button
											type="button"
											class="btn-close"
											data-bs-dismiss="modal"
											aria-label="Close"
										></button>
									</div>
									<div class="modal-body text-center">
										<h5 class="modal-title"><%=user.username%></h5>
									</div>
									<div class="modal-footer">
										<!-- <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button> -->
										<button
											type="button"
											class="btn btn-primary"
											data-bs-dismiss="modal"
										>
											Okay
										</button>
									</div>
								</div>
							</div>
						</div>

						<a
							href="#"
							class="card-btn"
							data-bs-toggle="modal"
							data-bs-target="#modal-simple1<%=user._id%>"
							><svg
								xmlns="http://www.w3.org/2000/svg"
								class="icon me-2 text-muted"
								width="24"
								height="24"
								viewBox="0 0 24 24"
								stroke-width="2"
								stroke="currentColor"
								fill="none"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path
									d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"
								/>
							</svg>
							Call</a
						>

						<div
							class="modal modal-blur fade"
							id="modal-simple1<%=user._id%>"
							tabindex="-1"
							role="dialog"
							aria-hidden="true"
						>
							<div
								class="modal-dialog modal-dialog-centered"
								role="document"
							>
								<div class="modal-content">
									<div class="modal-header">
										<h4 class="modal-title">Phone</h4>
										<button
											type="button"
											class="btn-close"
											data-bs-dismiss="modal"
											aria-label="Close"
										></button>
									</div>
									<div class="modal-body text-center">
										<h5 class="modal-title"><%=user.phone%></h5>
									</div>
									<div class="modal-footer">
										<!-- <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button> -->
										<button
											type="button"
											class="btn btn-primary"
											data-bs-dismiss="modal"
										>
											Okay
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<%}%>
		</div>
		<div class="d-flex mt-4">
			<ul class="pagination ms-auto">
				<li class="page-item disabled">
					<a class="page-link" href="#" tabindex="-1" aria-disabled="true">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="icon"
							width="24"
							height="24"
							viewBox="0 0 24 24"
							stroke-width="2"
							stroke="currentColor"
							fill="none"
							stroke-linecap="round"
							stroke-linejoin="round"
						>
							<path stroke="none" d="M0 0h24v24H0z" fill="none" />
							<polyline points="15 6 9 12 15 18" />
						</svg>
						prev
					</a>
				</li>
				<li class="page-item"><a class="page-link" href="#">1</a></li>
				<li class="page-item active">
					<a class="page-link" href="#">2</a>
				</li>
				<li class="page-item"><a class="page-link" href="#">3</a></li>
				<li class="page-item"><a class="page-link" href="#">4</a></li>
				<li class="page-item"><a class="page-link" href="#">5</a></li>
				<li class="page-item">
					<a class="page-link" href="#">
						next
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="icon"
							width="24"
							height="24"
							viewBox="0 0 24 24"
							stroke-width="2"
							stroke="currentColor"
							fill="none"
							stroke-linecap="round"
							stroke-linejoin="round"
						>
							<path stroke="none" d="M0 0h24v24H0z" fill="none" />
							<polyline points="9 6 15 12 9 18" />
						</svg>
					</a>
				</li>
			</ul>
		</div>
	</div>
</div>

<%}else{%> <%- include('../partials/noResultFound.ejs') %> <%}%>

<div
	class="modal modal-blur fade"
	id="new-user"
	tabindex="-1"
	role="dialog"
	aria-hidden="true"
>
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add a new user</h5>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="modal"
					aria-label="Close"
				></button>
			</div>
			<div class="modal-body">
				<form id="userForm">
					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label">Surname</label>
						<div class="col">
							<input
								type="text"
								id="surname"
								class="form-control"
								aria-describedby="emailHelp"
								placeholder="Enter surname"
							/>
							<small class="form-hint"
								>We'll never share your email with anyone else.</small
							>
						</div>
					</div>
					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label"
							>Othernames</label
						>
						<div class="col">
							<input
								id="othernames"
								type="text"
								class="form-control"
								aria-describedby="emailHelp"
								placeholder="Enter othernames"
							/>
							<small class="form-hint"
								>We'll never share your email with anyone else.</small
							>
						</div>
					</div>
					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label"
							>Username</label
						>
						<div class="col">
							<input
								type="email"
								id="username"
								class="form-control"
								aria-describedby="emailHelp"
								placeholder="Enter email"
							/>
							<small class="form-hint"
								>We'll use your email address to send you vital
								information. So, please enter a valid email
								address</small
							>
						</div>
					</div>

					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label">Phone</label>
						<div class="col">
							<input
								type="tel"
								id="phone"
								class="form-control"
								placeholder="Password"
							/>
							<small class="form-hint">
								Your password must be 8-20 characters long, contain
								letters and numbers, and must not contain spaces,
								special characters, or emoji.
							</small>
						</div>
					</div>
					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label">Role</label>
						<div class="col">
							<select class="form-select" id="role">
								<%if( roles.length > 0 ){%> <%for( var role of roles
								){%>
								<option value="<%=role%>"><%=role%></option>

								<%}%><%}%>
							</select>
						</div>
					</div>
					<div class="form-group mb-3 row">
						<label class="form-label col-3 col-form-label"
							>Profile Picture</label
						>
						<div class="col">
							<input type="file" class="form-control" id="image" />
							<small class="form-hint">
								We'll like you to put a face to this account.
							</small>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn me-auto" data-bs-dismiss="modal">
					Close
				</button>
				<button type="submit" class="btn btn-primary" form="userForm">
					Add User
				</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	const userForm = document.getElementById("userForm");

	userForm.addEventListener("submit", async event => {
		event.preventDefault();

		const surname = document.getElementById("surname");
		const othernames = document.getElementById("othernames");
		const username = document.getElementById("username");
		const phone = document.getElementById("phone");
		const role = document.getElementById("role");
		const image = document.getElementById("image");

		let data = new FormData();

		data.append("surname", surname.value);
		data.append("othernames", othernames.value);
		data.append("username", username.value);
		data.append("phone", phone.value);
		data.append("role", role.value);
		data.append("image", image.files[0]);

		const saveUser = await fetch(`<%=BASE_URL %>/user/new`, {
			method: "POST",
			body: data,
		}).then(response => response.json());
	});
</script>
