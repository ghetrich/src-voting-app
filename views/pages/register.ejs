<%- include('../partials/dashboardheader.ejs') %> 


<%if(register.length > 0){%>

<div class="content">
	<div class="container-xl">
		<!-- Page title -->
		<div class="page-header d-print-none">
			<div class="row align-items-center">
				<div class="col">
					<h2 class="page-title">Voters Register</h2>
					<div class="text-muted mt-1">
						1-18 of people
					</div>
				</div>
				<!-- Page title actions -->
				<div class="col-auto ms-auto d-print-none">
            <div class="btn-list">
                <span class="d-none d-sm-inline">
                    <a href="#" class="btn btn-white">
                        Bulk Upload
                    </a>
                </span>
                <a href="#" data-bs-toggle="modal" data-bs-target="#modal_new_voter" class="btn btn-primary d-none d-sm-inline-block"
                    >
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24"
                        stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Add new voter
                </a>
              
            </div>
        </div>
			</div>
		</div>

		<div class="row">

 <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Voters List</h3>
                </div>
                <div class="card-body border-bottom py-3">
                  <div class="d-flex">
                    <div class="text-muted">
                      Show
                      <div class="mx-2 d-inline-block">
                        <input type="text" class="form-control form-control-sm" value="8" size="3" aria-label="Invoices count">
                      </div>
                      entries
                    </div>
                    <div class="ms-auto text-muted">
                      Search:
                      <div class="ms-2 d-inline-block">
                        <input type="text" class="form-control form-control-sm" aria-label="Search invoice">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table card-table table-vcenter text-nowrap datatable">
                    <thead>
                      <tr>
                        <th class="w-1">Voter</th>
                        <th class="w-1"> Level
                        </th>
                        <th>Campus</th>
                        <th>Groups</th>
                        <th>Index No.</th>
                        <th>Created</th>
                        <th>Eligibility</th>                      
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
						<%for(var voter of register){%>
                      <tr>
                        <td data-label="name"><div class="d-flex py-1 align-items-center">
                            <span class="avatar me-2" style="background-image: url(/static/avatars/008f.jpg)"></span>
                            <div class="flex-fill"> 
                              <div class="font-weight-medium"><%=voter.othernames%> <%= voter.surname%></div>
                              <div class="text-muted"><a href="#" class="text-reset"><%=voter.email%></a></div>
                            </div>
                          </div></td>
                        <td><span class="text-muted"><%=voter.level.value%></span></td>
                        <td><a href="" class="text-reset" tabindex="-1"><%=voter.campus.name%></a></td>
                        <td>
                          <span class=""><svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="9" cy="7" r="4" /><path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /><path d="M21 21v-2a4 4 0 0 0 -3 -3.85" /></svg></span>
                          <a href="http://" class="text-reset"><%=voter.groups.length%> <%if(voter.groups.length > 1){%>Groups<%}else{%>Group<%}%></a>
                        </td>
                        <td>
                         <%=voter.index%> 
                        </td>
                        <td>
                         <%=moment(voter.createdAt).format('LL')%> 
                        </td>
                        <td>
                          <span class="badge <%if(voter.eligibility){%> bg-success <%}else{%> bg-danger <%}%> me-1"></span> <%if(voter.eligibility){%> Eligible <%}else{%> Ineligible <%}%>
                        </td>
                        
                        <td class="text-end">
                          <span class="dropdown">
                            <button class="btn dropdown-toggle align-text-top" data-bs-boundary="viewport" data-bs-toggle="dropdown">Actions</button>
                            <div class="dropdown-menu dropdown-menu-end">
                              <a class="dropdown-item" href="#">
                                Action
                              </a>
                              <a class="dropdown-item" href="#">
                                Another action
                              </a>
                            </div>
                          </span>
                        </td>
                      </tr>
                      <%}%>
                    </tbody>
                  </table>
                </div>
                <div class="card-footer d-flex align-items-center">
                  <p class="m-0 text-muted">Showing <span>1</span> to <span>8</span> of <span>16</span> entries</p>
                  <ul class="pagination m-0 ms-auto">
                    <li class="page-item disabled">
                      <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="15 6 9 12 15 18" /></svg>
                        prev
                      </a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item active"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item">
                      <a class="page-link" href="#">
                        next <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18" /></svg>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

		</div>
</div>
</div>

<%}else{%>
<%- include('../partials/noResultFound.ejs') %>

<%}%>


<div class="modal modal-blur fade" id="modal_new_voter" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New Voter</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="voterRegisterForm">
						<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Othernames</label
								>
								<div class="col">
									<input
										type="text"
										class="form-control"
										aria-describedby="emailHelp"
										placeholder="Provide given names?"
                                        id="othernames"
									/>
									<small class="form-hint"
										>We'll never share your email with anyone
										else.</small
									>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Surname</label>
								
								<div class="col">
									<input
										type="text"
										class="form-control"
										aria-describedby="emailHelp"
										placeholder="Provide family name?"
                                        id="surname"
									/>
									<small class="form-hint"
										>We'll never share your email with anyone
										else.</small
									>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>E-mail</label>
								
								<div class="col">
									<input
										type="email"
										class="form-control"
										aria-describedby="emailHelp"
										placeholder="Provide voter's school e-mail"
                                        id="email"
									/>
									<small class="form-hint"
										>We'll never share your email with anyone
										else.</small
									>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Index Number</label>
								
								<div class="col">
									<input
										type="text"
										class="form-control"
										aria-describedby="emailHelp"
										placeholder="Provide voter's index number"
                                        id="index"
									/>
									<small class="form-hint"
										>We'll never share your email with anyone
										else.</small
									>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Current Level</label>
								
								<div class="col">
									<div class="form-selectgroup">
									<%if(levels.length > 0){%>
										<%for( var [index, level] of levels.entries()){%>
									<label class="form-selectgroup-item">
                              		<input type="radio" name="level"  id="<%=level._id%>" value="<%=level._id%>" class="form-selectgroup-input" <%if(index == 0){%> checked="checked" <%}%> />
                             	 <span class="form-selectgroup-label"> <%=level.value%></span>
                            		</label>
									<%}%>
									<%}else{%>
										<span>NO campus to display</span>
										<%}%>
									</div>
									<small class="form-hint"
										>We'll never share your email with anyone
										else.</small
									>
								</div>
							</div>

							<!-- Group -->
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Campus</label>
								
								<div class="col">
								<div class="form-selectgroup">
									<%if(campuses.length > 0){%>
										<%for( var [index, campus] of campuses.entries()){%>
									<label class="form-selectgroup-item">
                              		<input type="radio" name="campus" id="<%=campus._id%>" value="<%=campus._id%>" class="form-selectgroup-input" <%if(index == 0){%> checked<%}%> />
                             	 <span class="form-selectgroup-label"><svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="5 12 3 12 12 3 21 12 19 12" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" /></svg> <%=campus.name%></span>
                            		</label>
									<%}%>
									<%}else{%>
										<span>NO campus to display</span>
										<%}%>
									</div>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Profile Picture</label>
								

								<div class="col">
									<div class="mb-3">								
										<input type="file" class="form-control" id="image" />
									</div>
									<small class="form-hint">
										Lorem ipsum dolor sit amet consectetur adipisicing
										elit. 
									</small>
								</div>
							</div>
							<div class="form-group mb-3 row">
								<label class="form-label col-3 col-form-label"
									>Group</label
								>

								<div class="col">
									
							<div class="form-selectgroup form-selectgroup-boxes d-flex flex-column">
							<%for(var group of groups){%>
							<label class="form-selectgroup-item flex-fill">
                              <input type="checkbox" name="groups"  value="<%=group._id%>" class="form-selectgroup-input" >
                              <div class="form-selectgroup-label d-flex align-items-center p-3">
                                <div class="me-3">
                                  <span class="form-selectgroup-check"></span>
                                </div>
                                <div class="form-selectgroup-label-content d-flex align-items-center">
                                  <span class="avatar me-3" ><%= group.name.charAt(0).toUpperCase() %></span>
                                  <div>
                                    <div class="font-weight-medium"><%=group.name%></div>
                                    <div class="text-muted"><%=moment(group.createdAt).format("LL")%></div>
                                  </div>
                                </div>
                              </div>
                            </label>
							<%}%>
</div>
								
								</div>
							</div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
            <button type="submit" form="voterRegisterForm" class="btn btn-primary" >Save changes</button>
          </div>
        </div>
      </div>
    </div>


	<script type="text/javascript">
	const voterRegisterForm = document.getElementById("voterRegisterForm");
	// const restricted = document.getElementById("restricted");
	// const eligibleVoters = document.getElementById("eligibleVoters");

	
	let groups = []

	// restricted.addEventListener("change", e=>{	
	// 		$("#eligibleVoters").toggleClass("d-none")

	// 		if (!e.target.checked) {
	// 		$.each($("input[name=amEligible]:checked"), function (){
	// 			$(this).click();
				
	// 		})
	// 		}
		
	// })


	voterRegisterForm.addEventListener("submit", async e => {
		e.preventDefault();

		const othernames = document.getElementById("othernames");

		const surname = document.getElementById("surname");

		const email = document.getElementById("email");

		const index = document.getElementById("index");

		const image = document.getElementById("image");

		const level = $("input[name=level]:checked").val();

		const campus = $("input[name=campus]:checked").val();

		
	
		$.each($("input[name=groups]:checked"), function (){
				groups.push($(this).val());
				
			})


		console.log({othernames: othernames.value, surname: surname.value, email: email.value, index: index.value, level: level, campus: campus, groups});
	
		let data = new FormData();

		data.append("othernames", othernames.value);
		data.append("surname", surname.value);
		data.append("email", email.value);
		data.append("index", index.value);
		data.append("level", level);
		data.append("campus", campus);

		groups.map(group => {
		data.append("groups[]", group);
		})
		
		data.append("image", image.files[0]);

		const saveVoter = await fetch(`/register/new`, {
			method: "POST",
			body: data,
		}).then(response => response.json());
	
	})

	

	</script>